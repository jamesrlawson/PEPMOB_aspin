{
    "collab_server" : "",
    "contents" : "require(gridExtra)\n\n\nregression_output <- function(df, split, x, y, z) { \n  \n  # split is a vector of factors for df to be split by, can have up to three elements\n  # x is the dependent variable\n  # y is the independent variable\n  # z is an interaction term\n  \n  x <- deparse(substitute(x))\n  y <- deparse(substitute(y))\n  z <- deparse(substitute(z))\n  \n  df$species_time_comb <- paste(as.character(df[[split[1]]]), df[[split[2]]], as.character(df[[split[3]]]), sep = \"-\")\n  \n  a <- data.frame()\n  my.list <- vector(\"list\", length(unique(df$species_time_comb)))\n  \n  for(i in 1:length(unique(df$species_time_comb))) {\n    sub <- unique(df$species_time_comb)[i]\n    df_sub <- subset(df, species_time_comb == sub)\n    \n    model <- lm(paste(y, '~', x, sep = \"\"), data = df_sub)\n    \n    model.stats <-  data.frame(cbind(sub,summary(model)$r.squared, summary(model)$coefficients[,4][2]))\n    names(model.stats) <- c('submodel','R2','pval') \n    rownames(model.stats) <- unique(df$species_time_comb)[i]\n    \n    my.list[[i]] <- model.stats\n    \n  }\n  \n  a <- rbind(a, do.call(rbind, my.list))\n  a$p.adj <- p.adjust(as.numeric(as.character(a$pval)), method = \"BH\")\n  \n  a$R2 <- signif(as.numeric(as.character(a$R2)), 3)\n  a$pval <- signif(as.numeric(as.character(a$pval)), 5)\n  a$p.adj <- signif(as.numeric(as.character(a$p.adj)), 5)\n  a$submodel <- as.character(a$submodel)\n  \n  return(a)\n  \n}\n\n\nplot_panel <- function(df, split, x, y, z, ...) {\n  \n  `+.uneval` <- function(a,b) {\n    `class<-`(modifyList(a,b), \"uneval\")\n  }\n  \n  # split is a vector of factors for df to be split by, can have up to three elements\n  # x is the dependent variable\n  # y is the independent variable\n  # z is an interaction term  \n  \n  x <- deparse(substitute(x))\n  y <- deparse(substitute(y))\n  z <- deparse(substitute(z))\n  \n  split1 <- split[1]\n  split2 <- split[2]\n  split3 <- split[3]\n  \n  #regression <- regression_output(df, split, x, y, z)\n  \n  df$species_time_comb <- paste(as.character(df[[split[1]]]), df[[split[2]]], as.character(df[[split[3]]]), sep = \"-\")\n  \n  plt <-  ggplot(phys_prot, aes_string(x=x,y=y)) +\n    ggtitle(paste(y, ' vs log10Gs', ' , submodels split by ', split1, split2, split3)) +\n    geom_point(size = 2, aes(color=species, shape = temp_treatment)) +\n    #  geom_smooth(method=lm,se=FALSE) +\n    geom_smooth(data=df[df$species_time_comb %in% regression[regression$pval < 0.05,]$submodel,], \n                aes_string(x=x, y=y), method='lm', se=FALSE, size = 0.5) +\n    scale_colour_hue(l=50) +  # Use a slightly darker palette than normal)\n    facet_grid(. ~ time, scales = \"free_x\") +\n    ylab(paste(y,' (mg protein / g leaf dry mass', sep = \"\")) +\n    xlab('log10(Gs) (mmol H20 / s / m2)') \n  \n  tt <- ttheme_default(colhead=list(fg_params = list(parse=TRUE)), base_size = 8)\n  tbl <- tableGrob(regression, rows=NULL, theme=tt)\n  table_size <- nrow(regression) * 0.3\n  # Plot chart and table into one object\n  grid.arrange(plt, tbl,\n               nrow=2,\n               as.table=TRUE,\n               bottom=TRUE,\n               heights=c(3,table_size))\n}\n\nwrite_panel <- function(df, split, x, y, z, ...) {\n  \n  `+.uneval` <- function(a,b) {\n    `class<-`(modifyList(a,b), \"uneval\")\n  }\n  \n  # split is a vector of factors for df to be split by, can have up to three elements\n  # x is the dependent variable\n  # y is the independent variable\n  # z is an interaction term  \n  \n  x <- deparse(substitute(x))\n  y <- deparse(substitute(y))\n  z <- deparse(substitute(z))\n  \n  split1 <- split[1]\n  split2 <- split[2]\n  split3 <- split[3]\n  \n  #regression <- regression_output(df, split, x, y, z)\n  \n  df$species_time_comb <- paste(as.character(df[[split[1]]]), df[[split[2]]], as.character(df[[split[3]]]), sep = \"-\")\n  \n  plt <-  ggplot(phys_prot, aes_string(x=x,y=y)) +\n    ggtitle(paste(y,'standardised by LMA', 'vs log10Gs', ' , submodels split by ', split1, split2, split3, sep = \" \")) +\n    geom_point(size = 2, aes(color=species, shape = temp_treatment)) +\n    #geom_smooth(method=lm,se=FALSE, size = 0.4, color = 'black\n    geom_smooth(data=df[df$species_time_comb %in% regression[regression$pval < 0.05,]$submodel,], \n                aes_string(x=x, y=y), method='lm', se=FALSE, size = 0.7, color = 'black') +\n    geom_smooth(data=df[df$species_time_comb %in% regression[regression$pval < 0.05,]$submodel,], \n                aes_string(x=x, y=y, color = paste(split3), linetype = paste(split2)), method='lm', se=FALSE, size = 0.5) +\n    \n    scale_colour_hue(l=50) +  # Use a slightly darker palette than normal)\n    facet_grid(. ~ time, scales = \"free_x\") +\n    ylab(paste(y,' (mg protein / g leaf dry mass)', sep = \"\")) +\n    xlab('log10(Gs) (mmol H20 / s / m2)') \n  \n  plt <- plt + theme_bw() \n  plt <- plt + theme_set(theme_bw(base_size = 8))\n  plt <- plt + theme(\n                 axis.title.y = element_text(hjust=0.35),\n                 axis.title.x = element_text(vjust=0.35),\n                 panel.grid.minor = element_blank(),\n                 panel.grid.major = element_blank(),\n                 axis.line = element_line(size=.5, color = \"black\"))\n  \n  tt <- ttheme_default(colhead=list(fg_params = list(parse=TRUE)), base_size = 8)\n  tbl <- tableGrob(regression, rows=NULL, theme=tt)\n  table_size <- nrow(regression) * 0.2\n  \n  # output figure\n  \n  figname <- paste(y, 'standardised by LMA','vs', x, 'submodels split by', split1, split2, split3, Sys.Date(), sep = \"_\")\n  pdf(sprintf(\"output/figs/%s.pdf\", figname), width = 10, height = 10, pointsize=8)\n  \n  # Plot chart and table into one object\n  grid.arrange(plt, tbl,\n               nrow=2,\n               as.table=TRUE,\n               bottom=TRUE,\n               heights=c(2,table_size))\n  \n  dev.off()\n}\n\n\n\nwrite_panel_ <- function(df, split, x, y, z, ...) {\n  \n  `+.uneval` <- function(a,b) {\n    `class<-`(modifyList(a,b), \"uneval\")\n  }\n  \n  # split is a vector of factors for df to be split by, can have up to three elements\n  # x is the dependent variable\n  # y is the independent variable\n  # z is an interaction term  \n  \n  x <- deparse(substitute(x))\n  y <- deparse(substitute(y))\n  z <- deparse(substitute(z))\n  \n  split1 <- split[1]\n  split2 <- split[2]\n  split3 <- split[3]\n  \n  #regression <- regression_output(df, split, x, y, z)\n  \n  df$species_time_comb <- paste(as.character(df[[split[1]]]), df[[split[2]]], as.character(df[[split[3]]]), sep = \"-\")\n  \n  plt <-  ggplot(phys_prot, aes_string(x=x,y=y)) +\n    ggtitle(paste(y, 'vs log10Gs', ' , submodels split by ', split1, split2, split3, sep = \" \")) +\n    geom_point(size = 2, aes(color=species, shape = temp_treatment)) +\n    #geom_smooth(method=lm,se=FALSE, size = 0.4, color = 'black\n    geom_smooth(data=df[df$species_time_comb %in% regression[regression$pval < 0.05,]$submodel,], \n                aes_string(x=x, y=y), method='lm', se=FALSE, size = 0.7, color = 'black') +\n    geom_smooth(data=df[df$species_time_comb %in% regression[regression$pval < 0.05,]$submodel,], \n                aes_string(x=x, y=y, color = paste(split3), linetype = paste(split2)), method='lm', se=FALSE, size = 0.5) +\n    \n    scale_colour_hue(l=50) +  # Use a slightly darker palette than normal)\n    facet_grid(. ~ time, scales = \"free_x\") +\n    ylab(paste(y,' (mg / m2)', sep = \"\")) +\n    xlab('log10(Gs) (mmol H20 / s / m2)') \n  \n  plt <- plt + theme_bw() \n  plt <- plt + theme_set(theme_bw(base_size = 8))\n  plt <- plt + theme(\n    axis.title.y = element_text(hjust=0.35),\n    axis.title.x = element_text(vjust=0.35),\n    panel.grid.minor = element_blank(),\n    panel.grid.major = element_blank(),\n    axis.line = element_line(size=.5, color = \"black\"))\n  \n  tt <- ttheme_default(colhead=list(fg_params = list(parse=TRUE)), base_size = 8)\n  tbl <- tableGrob(regression, rows=NULL, theme=tt)\n  table_size <- nrow(regression) * 0.2\n  \n  # output figure\n  \n  figname <- paste(y,'vs', x, 'submodels split by', split1, split2, split3, Sys.Date(), sep = \"_\")\n  pdf(sprintf(\"output/figs/%s.pdf\", figname), width = 10, height = 10, pointsize=8)\n  \n  # Plot chart and table into one object\n  grid.arrange(plt, tbl,\n               nrow=2,\n               as.table=TRUE,\n               bottom=TRUE,\n               heights=c(2,table_size))\n  \n  dev.off()\n}\n\n\n\n",
    "created" : 1466738627249.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "743066",
    "id" : "4C6561A5",
    "lastKnownWriteTime" : 1466758030,
    "last_content_update" : 1466758030239,
    "path" : "C:/Users/James/Desktop/stuff/PEPMOB/Aspinwall/scripts/functions.R",
    "project_path" : "scripts/functions.R",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 6,
    "source_on_save" : true,
    "source_window" : "",
    "type" : "r_source"
}